# Go REST API Example

![logo](logo.png)

## 技術スタック

+ Go
    + [Echo](https://echo.labstack.com/): Webフレームワーク
    + [zap](https://github.com/uber-go/zap): ロギング
    + [GORM](https://gorm.io/ja_JP/): ORMライブラリ
+ MariaDB
+ Docker

## 設計

### ソフトウェアアーキテクチャ

+ クリーンアーキテクチャを採用
+ 各コンポーネントは、`di.go` で依存性を解決
+ ユースケースおよびリポジトリは、インターフェースを採用

### ディレクトリ構造

```shell
.
├── cmd                 # アプリケーションのエントリーポイント
├── config              # アプリケーションの設定
├── internal            # プロジェクト内のモジュール
│   ├── app             # アプリケーション固有のロジックや処理
│   │   ├── di          # 依存性注入
│   │   └── handler     # HTTPリクエストを処理するハンドラ
│   ├── domain          # ビジネスロジックやエンティティ
│   │   ├── entity      # ビジネスエンティティ
│   │   ├── repository  # データベースや永続化層へのアクセスを抽象化するリポジトリ
│   │   └── usecase     # ビジネスロジックを提供するユースケース
│   └── infrastructure  # 基盤となるインフラストラクチャ
│       ├── db          # データベース
│       └── router      # ルーティング
├── pkg                 # プロジェクト内で共有される汎用的なライブラリ
│   ├── appenv          # アプリケーション環境
│   ├── auth            # 認証・認可に関連するユーティリティ
│   ├── erreurs         # エラーハンドリングやエラーメッセージ
│   ├── logger          # ロギング
│   ├── request         # HTTPリクエストに関連するユーティリティ
│   └── validator       # バリデーション
└── tests               # テストコード
```

### アプリケーションの設定

+ DB接続情報のようなアプリケーションの設定は、環境変数から読み込み

### ロギング

+ 標準出力
+ JSON形式
+ ロギングの対象:
    + リクエストログ（アクセスログ）
    + エラーログ
+ 本番環境下におけるデバッグレベルのロギングが可能

### バリデーション

+ データ項目単独のバリデーションは、`handler`で実施
+ 相関関係のあるバリデーションは、`usecase`で実施

### ロック

+ 更新または削除処理は、バージョン番号による楽観ロックを採用

## REST サービスの概要

ユーザを管理するサービス

### エンドポイント

+ `GET /ping`: ヘルスチェック
+ `POST /users`: 新しいユーザを作成する
+ `GET /users/{id}`: ユーザを取得する
+ `GET /users/search`: 条件に一致するユーザを取得する
+ `GET /users`: ユーザの一覧を取得する
+ `PUT /users/{id}`: ユーザを更新する
+ `PUT /users/change-password`: ユーザのパスワードを変更する
+ `DELETE /users/{id}`: ユーザを削除する
